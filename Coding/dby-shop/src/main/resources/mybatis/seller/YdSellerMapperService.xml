<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yd.dby.d.seller.mapper.YdSellerMapperService">
	<select id="index" resultMap="YdWebMapperServiceList">
		SELECT
			t.order_id,
			t.order_sn,
			t.buyer_id,
			t.buyer_name,
			t.payment_code,
			t.payment_time,
			t.finnshed_time,
			t.type,
			t.state_service,
			t.processing_status,
			t.state,
			t.total_price,
			t.coupon_price,
			t.goods_price,  
			t.refund_price,
			t.transport_price,
			t.transport_fid,
			t.created_at,
			yd_order_goods.goods_id,
			yd_order_goods.goods_name,
			yd_order_goods.og_state,
			yd_order_goods.goods_num,
			yd_order_goods.goods_price,
			yd_order_goods.goods_image,
			yd_order_goods.goods_pay_price
		FROM
		(
			SELECT
				order_id,
				store_id,
				order_sn,
				buyer_id,
				buyer_name,
				payment_code,
				payment_time,
				finnshed_time,
				TYPE,
				state_service,
				processing_status,
				state,
				total_price,
				coupon_price,
				goods_price,
				refund_price,
				transport_price,
				transport_fid,
				created_at
			FROM yd_order
			<trim prefix="where" suffixOverrides="and">
		  		<if test="orderSn != null and orderSn != ''">
		  		 	yd_order.order_sn = #{orderSn} and 
		  		</if>
		  		<if test="stateService != null and stateService != ''">
		  		 	yd_order.state_service = #{stateService} and 
		  		</if>
		  		store_id = #{store_id}
			</trim>
			limit #{to}, #{perPage}
		) t 
		LEFT OUTER JOIN yd_order_goods
		ON
		t.order_id = yd_order_goods.order_id
	</select>
	
	<select id="total" resultType="java.lang.Integer">
		SELECT
			COUNT(*)
		FROM
			yd_order
		<trim prefix="where" suffixOverrides="and">
			<if test="state > 0">
				state = #{state} and 
	  		</if>
	  		<if test="order_sn != null and order_sn != ''">
	  		 	order_sn = order_sn and 
	  		</if>
	  		store_id = #{store_id}
		</trim>
	</select>
	
	<resultMap id="YdWebMapperServiceList" type="java.util.HashMap">
		<id property="orderId" column="order_id" />
		<result property="orderSn" column="order_sn"/>
		<result property="buyerId" column="buyer_id"/>
		<result property="buyerName" column="buyer_name"/>
		<result property="paymentTime" column="payment_time"/>
		<result property="finnshedTime" column="finnshed_time"/>
		<result property="type" column="type"/>
		<result property="stateService" column="state_service"/>
		<result property="processingStatus" column="processing_status"/>
		<result property="state" column="state"/>
		<result property="totalPrice" column="total_price"/>
		<result property="couponPrice" column="coupon_price"/>
		<result property="goodsPrice" column="goods_price"/>
		<result property="refundPrice" column="refund_price"/>
		<result property="transportPrice" column="transport_price"/>
		<result property="transportFid" column="transport_fid"/>
		<result property="createdAt" column="created_at"/>
		
		<collection property="goods" javaType="java.util.ArrayList" ofType="java.util.HashMap">
			<id property="orderId" column="goods_id" />
			<result property="goodsId" column="goods_id"/>
			<result property="goodsName" column="goods_name"/>
			<result property="ogState" column="og_state"/>
			<result property="goodsNum" column="goods_num"/>
			<result property="goodsPrice" column="goods_price"/>
			<result property="goodsImage" column="goods_image"/>
			<result property="goodsPayPrice" column="goods_pay_price"/>
		</collection>
	</resultMap>
</mapper>