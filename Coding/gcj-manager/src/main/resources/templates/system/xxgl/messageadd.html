<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="renderer" content="webkit" />
    <title>添加系统消息</title>
    <link rel="stylesheet" href="/system/css/pintuer.css" />
    <link rel="stylesheet" href="/system/css/admin.css" />
    <script src="/system/js/jquery.js"></script>
    <script src="/system/js/pintuer.js"></script>  
</head>
<body>
<div class="panel admin-panel margin-top">
  <div class="panel-head" id="add"><strong><span class="icon-pencil-square-o"></span>添加系统消息</strong></div>
  <div class="body-content">
    <form method="post" class="form-x" action="/system/addMessage" id="addForm" >   
      <input type="hidden" name="id"  value="" />  
     <!--  <div class="form-group">
        <div class="label">
          <label>消息发送方：</label>
        </div>
        <div class="field">
          <input type="text" class="input w50" name="admin_name" value="" data-validate="required:请输入管理员名称" />         
          <div class="tips"></div>
        </div>
      </div> -->
        <div class="form-group">
            <div class="label">
                <label>消息内容：</label>
            </div>
            <div class="field">
            	<textarea  rows="4" cols="50" class="input w50" name="msg_contents" data-validate="required:请输入内容" oninput="strxz(this)"></textarea>
                <div class="tips"></div>
            </div>
        </div>
        
        <div class="form-group">
            <div class="label">
                <label>消息接收方：</label>
            </div>
            <div class="field">
            	<input type="text"  class="input w50" name="msg_sbid" placeholder="请输入全部或者用户昵称" data-validate="required:请输入全部或个人账号" id = "user_nickname" />
                <div class="tips"></div>
            </div>
        </div>
        
        <div class="form-group">
            <div class="label">
                <label>任务编号：</label>
            </div>
            <div class="field">
            	<input type="text"  class="input w50" name="task_num"  />
                <div class="tips"></div>
            </div>
        </div>
        
      <div class="form-group">
        <div class="label">
          <label>是否被删除：</label>
        </div>
        <div class="field">
          <div class="button-group radio">
          
          <!-- <label class="button active">
         	  <span class="icon icon-check"></span>             
              <input name="admin_isdel" value="0" type="radio" checked="checked" />是             
          </label>    -->          
        
          <label class="button active"><span class="icon icon-times"></span>          	
              <input name="msg_isdel" value="0"  type="radio" checked="checked"  />否
          </label>         
           </div>       
        </div>
     </div>
      
        <div class="form-group">
        <div class="label">
          <label></label>
        </div>
        <div class="field">
          <button class="button bg-main icon-check-square-o" type="button" id="btnSubmit" > 提交</button>
        </div>
      </div>
    </form>
  </div>
</div>
<script type="text/javascript">

 	$("#btnSubmit").click(function(){
 		var value = $("#user_nickname").val();
		var reg = /^\s+$/g;
		if (value == null || value.length == 0 || value=="" || reg.test(value)) {
			alert("输入内容不能为空");
			return;
		}
 		var data = $("#addForm").serializeArray();
 		var ydMangerSystemAdmin = {};
		$.each(data, function(k, v) {
			ydMangerSystemAdmin[ v["name"] ] = v["value"];
		});
 		
 		$.ajax({
 			url: "/system/addMessage",
 			data: $("#addForm").serialize(),
 			type: "post",
 			success: function(datas) {
 				if(datas.msg==true){
 					alert("添加成功");
 					location.reload();
 				}else{
 					alert("添加失败");
 				}
 			}
 		});
 	});
	
 	function strxz(tag){
 		var v = $(tag).val();
 		var num = 200;
 		if(v.length > num){
 			alert("最多字数200")
 			var value = v.substring(0,num);
 			$(tag).val(value);
 		}
 	}
 	
$("#user_nickname").change(function(){
	var user_nickname = $("#user_nickname").val();
	$.post("/system/queryUserByNickName",{"user_nickname":user_nickname},function(data){
		if(data.msg==true){
		};
		if(data.msg==false){
			alert("用户未编辑昵称或者不存在");
		};
		if(data.msg==200){
			
		}
		
	});
})
</script>
</body></html>