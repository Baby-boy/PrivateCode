package com.yd.gcj.service.impl;

import java.util.ArrayList;
import java.util.List;

import javax.servlet.http.HttpSession;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.yd.gcj.entity.YdMangerUserLabel;
import com.yd.gcj.entity.vo.YdMangerUserVo;
import com.yd.gcj.mapper.YdMangerMapperUserLabel;
import com.yd.gcj.service.YdMangerServiceUserLabel;
import com.yd.gcj.tool.MapInitFactory;
import com.yd.gcj.tool.Values;

@Service("ydMangerServiceUserLabel")
public class YdMangerServiceImplUserLabel implements YdMangerServiceUserLabel{
	
	@Autowired
	private YdMangerMapperUserLabel ydMangerMapperUserLabel;
	
	@Autowired
	private HttpSession session;
	
	@Override
	public List<YdMangerUserLabel> $queryAll(Integer userl_uid) {
		return ydMangerMapperUserLabel.$queryAll(userl_uid);
	}

	@Override
	public YdMangerUserLabel $queryById(Integer userl_id) {
		return ydMangerMapperUserLabel.$queryById(userl_id);
	}

	@Override
	public Integer $delete(Integer userl_id) {
		return ydMangerMapperUserLabel.$delete(userl_id);
	}

	@Override
	public Object $insert(Integer userId,String labelIdsStr,String reLabel) {
		MapInitFactory mapInitFactory = new MapInitFactory();
		try {
			
			if(labelIdsStr.length()>0){
				String[] labelIds = labelIdsStr.split(",");
				List<Integer> ids = new ArrayList<Integer>();
				for(String labelId : labelIds){
					ids.add(Integer.parseInt(labelId));
				}
				ydMangerMapperUserLabel.$delete(userId);
				Integer success = ydMangerMapperUserLabel.$insert(new MapInitFactory().setDatas("userId",userId).setDatas("ids",ids).getMap());
				if(success > 0){
					mapInitFactory.setMsg(Values.INITSUCCESSCODE, "提交成功，后台审核中！");
				}else{
					mapInitFactory.setMsg("501", "提交失败！");
				}
			}
			if(reLabel != null && !reLabel.isEmpty()){
				Integer success = ydMangerMapperUserLabel.$insertRe(userId, reLabel);
				if(success > 0){
					mapInitFactory.setMsg(Values.INITSUCCESSCODE, "提交成功，后台审核中！");
				}else{
					mapInitFactory.setMsg("501", "提交失败！");
				}
			}
			YdMangerUserVo userVo = (YdMangerUserVo) session.getAttribute("user");
			if(userVo != null){
				List<YdMangerUserLabel> labels = ydMangerMapperUserLabel.$queryAll(userVo.getUser_id());
				userVo.setUserLabels(labels);
				session.setAttribute("user", userVo);
			}
		} catch (Exception e) {
			e.printStackTrace();
			mapInitFactory.setSystemError();
		}
		return mapInitFactory.getMap();
	}
	
	/***
	 * 添加个人技能
	 * @param userId
	 * @param reLabel
	 * @return
	 */
	@Override
	public Object $insertRe(Integer userId,String reLabel){
		MapInitFactory mapInitFactory = new MapInitFactory();
		try {
			
		} catch (Exception e) {
			e.printStackTrace();
			mapInitFactory.setSystemError();
		}
		return mapInitFactory.getMap();
	}
	
	@Override
	public Integer $queryCountNumById(Integer userl_id) {
		return ydMangerMapperUserLabel.$queryCountNumById(userl_id);
	}

}
