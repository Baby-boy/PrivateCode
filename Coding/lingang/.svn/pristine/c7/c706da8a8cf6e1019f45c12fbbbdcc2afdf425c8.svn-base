<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.lingang.core.persistence.reader.SysStationReaderMapper" >
  <resultMap id="BaseResultMap" type="com.lingang.api.domain.entity.SysStation" >
    <id column="station_id" property="stationId" jdbcType="INTEGER" />
    <result column="region_id" property="regionId" jdbcType="INTEGER" />
    <result column="img_id" property="imgId" jdbcType="INTEGER" />
    <result column="station_title" property="stationTitle" jdbcType="VARCHAR" />
    <result column="station_simple" property="stationSimple" jdbcType="VARCHAR" />
    <result column="is_fictitious" property="isFictitious" jdbcType="INTEGER" />
    <result column="reg_number" property="regNumber" jdbcType="VARCHAR" />
    <result column="credit_code" property="creditCode" jdbcType="VARCHAR" />
    <result column="station_company" property="stationCompany" jdbcType="VARCHAR" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="loss_state" property="lossState" jdbcType="INTEGER" />
    <result column="station_state" property="stationState" jdbcType="INTEGER" />
    <result column="station_content" property="stationContent" jdbcType="VARCHAR" />
    <result column="top_state" property="topState" jdbcType="INTEGER" />
    <result column="top_time" property="topTime" jdbcType="TIMESTAMP" />
  </resultMap>
  
  <resultMap id="TopStationResultMap" type="com.lingang.api.domain.vo.SysStationVo" >
    <id column="station_id" property="stationId" jdbcType="INTEGER" />
    <result column="img_id" property="imgId" jdbcType="INTEGER" />
    <result column="img_path" property="imgPath" jdbcType="VARCHAR" />
    <result column="station_title" property="stationTitle" jdbcType="VARCHAR" />
	
	<collection property="parks" ofType="com.lingang.api.domain.entity.SysPark">
		<id column="park_id" property="parkId" jdbcType="INTEGER" />
		<result column="park_name" property="parkName" jdbcType="VARCHAR" />
	</collection>
	
	<collection property="labels" ofType="com.lingang.api.domain.entity.SysLabel">
		<id column="label_id" property="labelId" jdbcType="INTEGER" />
		<result column="label_name" property="labelName" jdbcType="VARCHAR" />
	</collection>
  </resultMap>
    <resultMap type="com.lingang.api.domain.vo.SysCompanyVo" id="sysCompanyVoMap">
  	<result column="company_id" property="companyId" jdbcType="INTEGER"></result>
  	<result column="company_name" property="companyName" jdbcType="VARCHAR"></result>
  	<result column="count_company" property="countCompany" jdbcType="INTEGER"></result>
    </resultMap>
    
    <resultMap id="sysPartnerNewAddMonthStatisticsVo"
		type="com.lingang.api.domain.vo.SysNewAddMonthStatisticsVo">
		<result column="create_year" property="createYear" jdbcType="VARCHAR" />
		<result column="create_month" property="createMonth" jdbcType="VARCHAR" />
		<result column="count_add" property="countAdd" jdbcType="INTEGER" />
		<result column="type" property="type" jdbcType="INTEGER" />
	</resultMap>
	<resultMap id="sysPartnerNewAddQuarterStatisticsVo"
		type="com.lingang.api.domain.vo.SysNewAddQuarterStatisticsVo">
		<result column="create_year" property="createYear" jdbcType="VARCHAR" />
		<result column="create_quarter" property="createQuarter" jdbcType="VARCHAR" />
		<result column="count_add" property="countAdd" jdbcType="INTEGER" />
		<result column="type" property="type" jdbcType="INTEGER" />
	</resultMap>
	
  <resultMap id="SysStationVoResultMap" type="com.lingang.api.domain.vo.SysStationVo" extends="BaseResultMap">
    <result column="img_path" property="imgPath" jdbcType="VARCHAR" />
    
    <!-- 收藏相关字段 -->
	<result column="collect_id" property="collectId" jdbcType="INTEGER" />
    
	<collection property="parks" ofType="com.lingang.api.domain.entity.SysPark">
		<id column="park_id" property="parkId" jdbcType="INTEGER" />
		<result column="park_name" property="parkName" jdbcType="VARCHAR" />
	</collection>
	<!-- 入驻:（园区） -->
	<collection property="parksvo" ofType="com.lingang.api.domain.vo.SysParkVo">
		<id column="station_park_id" property="parkId" jdbcType="INTEGER" />
		<result column="parkImgId" property="parkImgId" jdbcType="INTEGER" />
		<result column="station_park_name" property="parkName" jdbcType="VARCHAR" />
		<result column="parkImgPath" property="parkImgPath" jdbcType="VARCHAR" />
	</collection>
	 
	<!-- 入驻:（集群） -->
	<collection property="industrys" ofType="com.lingang.api.domain.vo.SysIndustryVo">
		<id column="industry_id" property="industryId" jdbcType="INTEGER" />
		<result column="industry_title" property="industryTitle" jdbcType="VARCHAR" />
		<result column="industryImgId" property="industryImgId" jdbcType="INTEGER" />
		<result column="industryImgPath" property="industryImgPath" jdbcType="VARCHAR" />
	</collection>
	<!-- 入驻:（客户经理） -->
	<collection property="umanagers" ofType="com.lingang.api.domain.entity.SysUmanager">
		<id column="umanager_id" property="umanagerId" jdbcType="INTEGER" />
		<result column="umanager_name" property="umanagerName" jdbcType="VARCHAR" />
		<result column="umanager_company" property="umanagerCompany" jdbcType="VARCHAR" />
		<result column="umanager_department" property="umanagerDepartment" jdbcType="VARCHAR" />
		<result column="umanager_email" property="umanagerEmail" jdbcType="VARCHAR" />
		<result column="umanager_tel" property="umanagerTel" jdbcType="VARCHAR" />
		<result column="umanager_mobile" property="umanagerMobile" jdbcType="VARCHAR" />
	</collection>
	
  	<collection property="labels" ofType="com.lingang.api.domain.entity.SysLabel">
		<id column="label_id" property="labelId" jdbcType="INTEGER" />
		<result column="label_name" property="labelName" jdbcType="VARCHAR" />
	</collection>
	
	<!-- 管理公司 -->
	<collection property="companys" ofType="com.lingang.api.domain.entity.SysCompany">
		<id column="company_id" property="companyId" jdbcType="INTEGER" />
		<result column="company_name" property="companyName" jdbcType="VARCHAR" />
	</collection>
  </resultMap>
  
  <!-- 后台逻辑 -->
  <resultMap id="SysStationPfVoResultMap" type="com.lingang.api.domain.pfvo.SysStationPfVo" extends="BaseResultMap">
  	<result column="region_name" property="regionName" jdbcType="VARCHAR"/>
  </resultMap>
  
  <sql id="Base_Column_List" >
    station_id, region_id, img_id, station_title, station_simple, is_fictitious, reg_number, 
    credit_code, station_company, create_time, update_time, loss_state, station_state
  </sql>
  <sql id="Blob_Column_List" >
    station_content
  </sql>
  <select id="selectByPrimaryKey" resultMap="SysStationVoResultMap" parameterType="java.lang.Integer" >
	SELECT  
	st.station_id,st.region_id,st.station_title,st.station_simple,st.is_fictitious,sm.img_id,sm.img_path,st.loss_state,
	sl.label_id,sl.label_name,st.reg_number,st.credit_code,st.station_content,sp.park_id AS station_park_id,
	sp.park_name AS station_park_name,smp.img_id AS parkImgId,smp.img_path AS parkImgPath,si.industry_id,si.industry_title,
	smi.img_id AS industryImgId,smi.img_path AS industryImgPath,su.umanager_id,su.umanager_name,
	su.umanager_company,su.umanager_department,su.umanager_email,su.umanager_tel,su.umanager_mobile,
	st.station_company,st.create_time,st.station_state,
	<!-- sc.company_id,sc.company_name两字段为后来添加,实现一对多 -->
	sc.company_id,sc.company_name
	from sys_station st 
	LEFT JOIN (SELECT * from sys_images where img_state=1) sm ON st.img_id=sm.img_id
	LEFT JOIN sys_station_label ssl ON st.station_id=ssl.station_id
	LEFT JOIN (SELECT * from sys_label where label_state=1) sl on ssl.label_id=sl.label_id
	LEFT JOIN sys_station_park stp on st.station_id=stp.station_id
	LEFT JOIN (SELECT * from sys_park where park_state=2) sp ON stp.park_id=sp.park_id
	LEFT JOIN sys_station_industry ssi on st.station_id=ssi.station_id
	LEFT JOIN (SELECT * from sys_industry where industry_state=2) si ON ssi.industry_id=si.industry_id
	LEFT JOIN sys_station_umanager ssu ON st.station_id=ssu.station_id
	LEFT JOIN sys_umanager su ON ssu.umanager_id=su.umanager_id
	LEFT JOIN (SELECT * from sys_images where img_state=1) smp ON sp.min_img_id=smp.img_id
	LEFT JOIN (SELECT * from sys_images where img_state=1) smi on si.min_img_id=smi.img_id
	<!-- sys_assort,sys_company两数据库表为后来添加,实现一对多 -->
	LEFT JOIN (SELECT * FROM sys_assort WHERE assort_type=4) sa ON sa.obj_id=st.station_id
	LEFT JOIN (SELECT * FROM sys_company WHERE company_state=2)sc ON sc.company_id=sa.company_id
  	where st.station_id = #{stationId,jdbcType=INTEGER}
  </select>
   
  <sql id="SQL_SysStation_id">
     station_id
  </sql>
 
  <!-- app列表重写 -->
  <sql id="where_selectSysStationPageList">
  	<where>
       st.station_state=2 
       <if test="map.industryIds !=null and map.industryIds !=''">
           and si.industry_id in
           <foreach collection="map.industryIds" item="industryIds" open="(" close=")" separator=",">
					#{industryIds}
			</foreach>
       </if>
       <if test="map.labelIds !=null and map.labelIds !=''">
            and sl.label_id in
             <foreach collection="map.labelIds" item="labelIds" open="(" close=")" separator=",">
					#{labelIds}
			</foreach>
       </if>
       <!-- <if test="map.regionId !=null and map.regionId !=''">
            and st.region_id= #{map.regionId,jdbcType=INTEGER}
       </if> -->
       <if test="map.regionTypeId !=null and map.regionTypeId !=''">
            and sr.region_type= #{map.regionTypeId,jdbcType=INTEGER}
       </if>
        <if test="map.parkId !=null and map.parkId !=''">
            and sp.park_id= #{map.parkId,jdbcType=INTEGER}
       </if>
       <if test="map.beninTime !=null and map.beninTime !=''">
       		 and st.create_time >= #{map.beninTime}
       </if>
       <if test="map.endTime !=null and map.endTime !=''">
       		 and st.create_time <![CDATA[ < ]]> #{map.endTime}
       </if>
       <if test="map.companyId !=null and map.companyId !=''">
            and sa.company_id= #{map.companyId,jdbcType=INTEGER}
       </if>
    </where>   
  </sql>
  <!-- 关联表 -->
  <sql id="relation_selectSysStationPageList">
  	left join sys_station_industry sti on st.station_id=sti.station_id
	left join sys_industry si on sti.industry_id=si.industry_id
	left join sys_station_label stl on st.station_id=stl.station_id
	left join (select * from sys_label where label_state=1) sl on stl.label_id=sl.label_id
	left join (select * from sys_images where img_state=1) sm on st.img_id=sm.img_id
	left join sys_station_park ssp on ssp.station_id=st.station_id
	left join (select * from sys_park where park_state=2) sp on sp.park_id=ssp.park_id
	left join sys_region sr on sr.region_id=sp.region_id
	left join (select * from sys_assort where assort_type=4) sa on sa.obj_id=st.station_id
  </sql>
  <select id="selectSysStationCount" resultType="java.lang.Integer" parameterType="java.util.Map">
	select COUNT(DISTINCT st.station_id) 
	from sys_station st
	<include refid="relation_selectSysStationPageList"/>
	<include refid="where_selectSysStationPageList"/>
  </select>
  <select id="selectSysStationPageList" resultMap="SysStationVoResultMap" parameterType="java.util.Map" >
    WITH cte AS(
		select st.station_id,
			ROW_NUMBER() OVER(ORDER BY st.create_time DESC) AS rownum
		from sys_station st
		<include refid="relation_selectSysStationPageList"/>
		<include refid="where_selectSysStationPageList"/>
		GROUP BY st.station_id,st.create_time
	)

	select st.station_id,st.station_title,st.img_id,st.station_simple,st.station_content,sm.img_path,sl.label_id,sl.label_name,
	    sp.park_id,sp.park_name
	from
		(select * from cte where rownum between #{map.startIndex} and (#{map.startIndex} + #{map.onePageCount} - 1)) stt
	left join sys_station st on st.station_id=stt.station_id
	<include refid="relation_selectSysStationPageList"/>
  </select>
  
  <!-- 后台逻辑 -->
  <select id="selectSysStationPfVoCount" resultType="java.lang.Integer" parameterType="java.util.Map">
  	select count(DISTINCT ss.station_id)
	from sys_station ss
	left join sys_region sr on sr.region_id=ss.region_id
	<where>
		1=1
		<if test="map.stationTitleKeywords !=null and map.stationTitleKeywords !=''">
			and station_title like '%${map.stationTitleKeywords}%'
		</if>
		<if test="map.regionNameKeywords !=null and map.regionNameKeywords !=''">
			and region_name like '%${map.regionNameKeywords}%'
		</if>
		<if test="map.stationState !=null and map.stationState !=''">
			and station_state = #{map.stationState}
		</if>
	</where>
  </select>
  <sql id="SQL_selectSysStationPfVoPageList">
  	select ss.station_id,ss.station_title,ss.is_fictitious,ss.reg_number,ss.station_company,
	ss.create_time,ss.update_time,ss.station_state,ss.loss_state,sr.region_name
	from sys_station ss
	left join sys_region sr on sr.region_id=ss.region_id
  	<where>
		1=1
		<if test="map.stationTitleKeywords !=null and map.stationTitleKeywords !=''">
			and station_title like '%${map.stationTitleKeywords}%'
		</if>
		<if test="map.regionNameKeywords !=null and map.regionNameKeywords !=''">
			and region_name like '%${map.regionNameKeywords}%'
		</if>
		<if test="map.stationState !=null and map.stationState !=''">
			and station_state = #{map.stationState}
		</if>
	</where>
  </sql>
  <sql id="SQL_ID_selectSysStationPfVoPageList">
  	station_id
  </sql>
  <select id="selectSysStationPfVoPageList" resultMap="SysStationPfVoResultMap" parameterType="java.util.Map">
  	SELECT TOP ${map.onePageCount}
		*
	FROM 
	(
		<include refid="SQL_selectSysStationPfVoPageList" />
	)
	 t
	WHERE t.<include refid="SQL_ID_selectSysStationPfVoPageList" /> 
	NOT IN
	(
		SELECT TOP (${map.onePageCount} * ${map.startIndex}) 
		nt.<include refid="SQL_ID_selectSysStationPfVoPageList" /> 
		FROM 
		(
			<include refid="SQL_selectSysStationPfVoPageList" />
		) nt ORDER BY create_time DESC
	)
	ORDER BY create_time DESC;
  </select>
 
	<select id="selectNewAddMonth" resultMap="sysPartnerNewAddMonthStatisticsVo">
		SELECT
			YEAR (create_time) create_year,
			MONTH (create_time) create_month,
			COUNT (create_time) count_add,
			1 type
		FROM
			sys_station
		GROUP BY
			YEAR (create_time),
			MONTH (create_time)
		ORDER BY
			create_year,
			create_month
	</select>
	<select id="selectNewAddQuarter" resultMap="sysPartnerNewAddQuarterStatisticsVo">
		SELECT
			DATENAME(YEAR, create_time) create_year, 
			DATENAME(quarter, create_time) create_quarter,
			COUNT (1) count_add, 
			2 type
		FROM
			sys_station t
		GROUP BY
			DATENAME(YEAR, create_time),
			DATENAME(quarter, create_time)
		ORDER BY
			CONVERT (
				INT,
				DATENAME(quarter, create_time)
			)
	</select>
	<select id="selectNewAddMonthMax" resultType="java.lang.Integer">
		SELECT
			MAX (count_add)
		FROM
			(
				SELECT
					YEAR (create_time) create_year,
					MONTH (create_time) create_month,
					COUNT (create_time) count_add,
					1 type
				FROM
					sys_station
				GROUP BY
					YEAR (create_time),
					MONTH (create_time)
			) temp
	</select>
	<select id="selectNewAddQuarterMax" resultType="java.lang.Integer">
		SELECT
			MAX (count_add)
		FROM
			(
				SELECT
					DATENAME(YEAR, create_time) create_year,
					DATENAME(quarter, create_time) create_quarter,
					COUNT (1) count_add,
					2 type
				FROM
					sys_station t
				GROUP BY
					DATENAME(YEAR, create_time),
					DATENAME(quarter, create_time)
			) temp
	</select>

  
  <select id="selectStationAllCount" resultType="java.lang.Integer">
  	select 
	count(station_id) num 
	from 
	sys_station 
  </select>
  
  <select id="selectmoreStationStatisticsCount" resultType="java.lang.Integer">
  	select 
	count(station_id) num 
	from 
	sys_station 
  </select>
  
  
  
  
  <!-- 后台 -->
  <!-- ***********************************2016-12-15 gsh改********************************* -->
	<select id="querySysStationCount" resultType="java.lang.Integer" parameterType="java.util.Map" >
<!--     	SELECT count(*) from sys_station st
    where st.station_title like '%${map.stationTitle}%' and st.station_state <![CDATA[!=]]> 3
    and st.station_id <if test="map.stationIstop!=1"> not </if> in (select obj_id from sys_top where top_type = 3) -->
  		select count(DISTINCT st.station_id)from sys_station st
		where 
		st.station_id in (select st.obj_id from sys_top st where st.top_type=3)
		and st.station_state <![CDATA[!=]]>3
		<if test="map.stationState !=null and map.stationState !=''">
		and st.station_state = #{map.stationState,jdbcType=INTEGER}
		</if>
		<if test="map.stationTitle !=null and map.stationTitle !=''">
		and st.station_title like '%${map.stationTitle}%'
		</if>
  	</select>
  
  
<!--   <sql id="SQL_querySysStationPageList">
    select st.station_id,st.station_title,st.station_simple,st.station_company,st.create_time,st.loss_state,
    st.station_state
    from sys_station st
    where st.station_title like '%${map.stationTitle}%' and st.station_state <![CDATA[!=]]> 3
    and st.station_id <if test="map.stationIstop!=1"> not </if> in (select obj_id from sys_top where top_type = 3)
  </sql> -->
  
  
  <select id="queryAllByPage" resultMap="SysStationVoResultMap" parameterType="java.util.Map" >
	  SELECT TOP ${map.onePageCount} *
		FROM 
		(
	    select st.station_id,st.station_title,st.station_simple,st.station_company,st.create_time,st.loss_state,
	    st.station_state,st.top_time
	    from sys_station st  where st.top_state =1
	
		)
		 t
		WHERE t.station_id
		NOT IN
		(
			SELECT TOP (${map.onePageCount}*${map.startIndex}) 
			nt.station_id
			FROM 
			(
	    select st.station_id,st.station_title,st.station_simple,st.station_company,st.create_time,st.loss_state,
	    st.station_state
	    from sys_station st where st.top_state =1
			) nt  ORDER BY nt.create_time DESC
		)
			<if test="map.stationState !=null and map.stationState !=''">
			and t.station_state = #{map.stationState,jdbcType=INTEGER}
			</if>
			<if test="map.stationTitle !=null and map.stationTitle !=''">
			and t.station_title like '%${map.stationTitle}%'
			</if>
	        and t.station_state <![CDATA[!=]]> 3
	        ORDER BY t.top_time DESC
  </select>
  
  
    <!--创建单位统计  -->
    <select id="selectStationCompanyTotalCount" resultType = "java.lang.Integer"> 
	SELECT
		MAX (count_company)
	FROM
		(
			SELECT
				s2.company_id,
				s2.company_name,
				COUNT (s2.company_id) AS count_company
			FROM
				sys_assort s1
			INNER JOIN sys_company s2 ON s1.company_id = s2.company_id
			AND s1.assort_type = 4
			GROUP BY
				s2.company_id,
				s2.company_name
		) temp
  </select>
  
    <!--创建单位统计  -->
  <select id="selectStationCompanyCount" resultMap = "sysCompanyVoMap"> 
	SELECT
		s2.company_id,
		s2.company_name,
		COUNT (s2.company_id) AS count_company
	FROM
		sys_assort s1
	INNER JOIN sys_company s2 ON s1.company_id = s2.company_id
	AND s1.assort_type = 4
	GROUP BY
		s2.company_id,
		s2.company_name;
  </select>
  
  <select id="selectUserCollectCount" resultType="java.lang.Integer" parameterType="java.util.Map">
  	select COUNT (DISTINCT sc.collect_id) 
    from sys_collect sc
	<!-- LEFT JOIN sys_station st ON st.station_id=sc.obj_id
    LEFT JOIN sys_station_industry sti on st.station_id=sti.station_id
    LEFT JOIN sys_region sr on st.region_id=sr.region_id
    LEFT JOIN sys_industry si on sti.industry_id=si.industry_id
    LEFT JOIN sys_station_label stl ON st.station_id=stl.station_id
    LEFT JOIN (select * from sys_label where label_state=1) sl on stl.label_id=sl.label_id
    LEFT JOIN (select * from sys_images WHERE img_state=1) sm on st.img_id=sm.img_id
    LEFT JOIN sys_station_park stp ON st.station_id=stp.park_id
    LEFT JOIN (select * from sys_park where park_state=2) sp ON stp.park_id=sp.park_id -->
    where sc.user_id=#{map.userId,jdbcType=INTEGER} and sc.collect_type=4
  </select>
  <sql id="SQL_selectUserCollectPageList">
	select * from sys_collect where collect_type=4
  </sql>
  <sql id="SQL_selectUserCollectPageList_id">
     collect_id
  </sql>
   <sql id="PAGING_selectUserCollectPageList">
    SELECT TOP ${map.onePageCount}
		*
	FROM 
	(
		<include refid="SQL_selectUserCollectPageList" />
	)
	 t
	WHERE t.<include refid="SQL_selectUserCollectPageList_id" /> 
	NOT IN
	(
		SELECT TOP (${map.onePageCount} * ${map.startIndex}) 
		nt.<include refid="SQL_selectUserCollectPageList_id" /> 
		FROM 
		(
			<include refid="SQL_selectUserCollectPageList" />
		) nt order by nt.create_time desc
	) order by t.create_time desc
  </sql>
  <select id="selectUserCollectPageList" resultMap="SysStationVoResultMap" parameterType="java.util.Map" >
    select sc.collect_id,st.station_id,st.station_title,st.img_id,sm.img_path,sl.label_id,sl.label_name,
    sp.park_id,sp.park_name
    from (
    	<include refid="PAGING_selectUserCollectPageList"/>
    ) sc
	LEFT JOIN sys_station st ON st.station_id=sc.obj_id
    LEFT JOIN sys_station_industry sti on st.station_id=sti.station_id
    LEFT JOIN sys_region sr on st.region_id=sr.region_id
    LEFT JOIN sys_industry si on sti.industry_id=si.industry_id
    LEFT JOIN sys_station_label stl ON st.station_id=stl.station_id
    LEFT JOIN (select * from sys_label where label_state=1) sl on stl.label_id=sl.label_id
    LEFT JOIN (select * from sys_images WHERE img_state=1) sm on st.img_id=sm.img_id
    LEFT JOIN sys_station_park stp ON st.station_id=stp.park_id
    LEFT JOIN (select * from sys_park where park_state=2) sp ON stp.park_id=sp.park_id
    where sc.user_id=#{map.userId,jdbcType=INTEGER} and sc.collect_type=4
  </select>
  
    <select id="selectTopStationCount" resultType="java.lang.Integer" parameterType="java.util.Map">
  	select count(DISTINCT st.top_id) 
	from sys_top st
	left join (select * from sys_station where station_state=2) sp on sp.station_id=st.obj_id 
	left join (select * from sys_images where img_state=1) si on si.img_id=sp.img_id 
	left join sys_station_park spp on spp.station_id=sp.station_id 
	left join (select * from sys_park where park_state=2) spa on spa.park_id=spp.park_id 
	left join sys_station_label spl on spl.station_id=sp.station_id 
	left join (select * from sys_label where label_state=1) sl on sl.label_id=spl.label_id 
	where st.top_type=3  and sp.station_state=2
  </select>
  <sql id="SQL_selectTopStationVoPageList" >
		 select 
	    <include refid="Base_Column_List" />
	    from sys_top where top_type=3
  </sql>
	<sql id="SQL_ID_selectTopStationVoPageList" >
		top_id
	</sql>
  <sql id="PAGING_selectTopStationVoPageList">
	SELECT TOP ${map.onePageCount}
		*
	FROM 
	(
		<include refid="SQL_selectTopStationVoPageList" />
	)
	 t
	WHERE t.<include refid="SQL_ID_selectTopStationVoPageList" /> 
	NOT IN
	(
		SELECT TOP (${map.onePageCount} * ${map.startIndex}) 
		nt.<include refid="SQL_ID_selectTopStationVoPageList" /> 
		FROM 
		(
			<include refid="SQL_selectTopStationVoPageList" />
		) nt
	)
  </sql>
  <select id="selectTopStationVoPageList" resultMap="TopStationResultMap" parameterType="java.util.Map">
	select st.station_id,st.station_title,st.top_state,st.top_time,si.img_id,si.img_path,spa.park_id,spa.park_name,sl.label_id,sl.label_name 
		from (
			SELECT TOP ${map.onePageCount}
		*
	FROM 
	(
		 select * from sys_station where station_state=2 and top_state = 1
	)
	 t
	WHERE t.station_id
	NOT IN
	(
		SELECT TOP (${map.onePageCount} * ${map.startIndex}) 
		nt.station_id
		FROM 
		(
			 select * from sys_station where station_state=2 and top_state = 1
		) nt
	)
		) st
		left join (select * from sys_images where img_state=1) si on si.img_id=st.img_id 
		left join sys_station_park spp on spp.station_id=st.station_id 
		left join (select * from sys_park where park_state=2) spa on spa.park_id=spp.park_id 
		left join sys_station_label spl on spl.station_id=st.station_id 
		left join (select * from sys_label where label_state=1) sl on sl.label_id=spl.label_id 
	where st.station_state=2
   order by st.top_time DESC
  </select>
  
    
    <!-- 检索-相关入驻企业总条数 -->
   <select id="searchSysStationCount" resultType="java.lang.Integer" parameterType="java.util.Map">
	select COUNT(st.station_id) from sys_station st
    <where>
       st.station_state=2  	AND
		CONTAINS (station_title, '${map.keywords}')
		OR CONTAINS (station_content, '${map.keywords}')
		OR CONTAINS (station_company, '${map.keywords}')
    </where>  
  </select>
	    <!-- 检索-入驻列表 -->
	   <sql id="SEARCH_selectSysStationPageList" >
	    SELECT TOP ${map.onePageCount}
			*
		FROM 
		(
			<include refid="SQL_searchSysStationPageList" />
		)
		 t
		WHERE t.<include refid="SQL_SysStation_id" /> 
		NOT IN
		(
			SELECT TOP (${map.onePageCount} * ${map.startIndex}) 
			nt.<include refid="SQL_SysStation_id" /> 
			FROM 
			(
				<include refid="SQL_searchSysStationPageList" />
			) nt
		)
	  </sql>
      <!-- 检索-入驻列表 -->
	  <sql id="SQL_searchSysStationPageList">
		SELECT
			*
		FROM
			sys_station
		WHERE
			CONTAINS (station_title, '${map.keywords}')
		OR CONTAINS (station_content, '${map.keywords}')
		OR CONTAINS (station_company, '${map.keywords}')
	  </sql>
      <!-- 检索-入驻企业列表 -->
      <select id="searchSysStationVoPageList" resultMap="SysStationVoResultMap" parameterType="java.util.Map" >
    	select st.station_id,st.station_title,st.img_id,st.station_simple,st.station_content,sm.img_path,sl.label_id,sl.label_name,
	    sp.park_id,sp.park_name
	    from (
	    	<include refid="SEARCH_selectSysStationPageList"/>
	    ) st
	    LEFT JOIN sys_station_industry sti on st.station_id=sti.station_id
	    LEFT JOIN sys_region sr on st.region_id=sr.region_id
	    LEFT JOIN sys_industry si on sti.industry_id=si.industry_id
	    LEFT JOIN sys_station_label stl ON st.station_id=stl.station_id
	    LEFT JOIN (select * from sys_label where label_state=1) sl on stl.label_id=sl.label_id
	    LEFT JOIN (select * from sys_images WHERE img_state=1) sm on st.img_id=sm.img_id
	    LEFT JOIN sys_station_park stp ON st.station_id=stp.park_id
	    LEFT JOIN (select * from sys_park where park_state=2) sp ON stp.park_id=sp.park_id
	    left join sys_station_park ssp on ssp.station_id=st.station_id
	    <where>
	       st.station_state=2 
	    </where> 
	    order by st.create_time desc
      </select>
  
</mapper>